import Groq from 'groq-sdk';
const allowedOrigins = ['http://localhost:5173','http://localhost:3000',process.env.VERCEL_URL?`https://${process.env.VERCEL_URL}`:''].filter(Boolean);
export default async function handler(req,res){const origin=req.headers.origin;if(allowedOrigins.includes(origin))res.setHeader('Access-Control-Allow-Origin',origin);res.setHeader('Access-Control-Allow-Methods','POST, OPTIONS');res.setHeader('Access-Control-Allow-Headers','Content-Type');if(req.method==='OPTIONS')return res.status(200).end();if(req.method!=='POST')return res.status(405).json({error:'Method Not Allowed'});try{const apiKey=process.env.GROQ_API_KEY;if(!apiKey)return res.status(500).json({error:'GROQ_API_KEY not configured'});const{messages,model,temperature,max_tokens}=req.body;if(!messages||!Array.isArray(messages))return res.status(400).json({error:'Invalid messages format'});const groq=new Groq({apiKey});const completion=await groq.chat.completions.create({messages,model:model||'llama-3.1-8b-instant',temperature:temperature||0.7,max_tokens:max_tokens||1024});return res.status(200).json({success:true,data:completion.choices[0]?.message?.content||'',usage:completion.usage})}catch(error){return res.status(500).json({error:'Internal Server Error',message:error.message})}}
export const config={maxDuration:30,regions:['iad1']};
